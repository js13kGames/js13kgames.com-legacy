{{!< main }}

{{#unless entry}}
<h3>Submission not found!</h3>

<p>The game you are looking for doesn't exist or hasn't been approved yet. Go back to the <a href="/admin/submissions">admin panel</a> and try again.</p>
{{else}}
<h3>{{entry.title}}</h3>
<div><img src="/games/{{entry.slug}}/__big.jpg" alt="{{entry.title}}" /></div>

<p><strong>File size:</strong> {{entry.file_size}} KB</p>
<p><strong>Author:</strong> {{entry.author}}</p>
<p><strong>Description:</strong> {{entry.description}}</p>
<!-- if server -->
<!-- a href="{$entry->server_url }" target="_blank" class="launch">Play the game</a -->
<!-- else -->
<a href="/games/{{entry.slug}}/index.html" target="_blank" class="launch">Play the game</a>

<h3>Cast your vote</h3>
<p>Remember that this year's theme is <strong>{{criteria.0.obj.edition.theme}}</strong></p>
<form id="voting-widgets">
  <input type="hidden" name="submission_id" value="{{entry.id}}" />
  <input type="hidden" name="user_id" value="{{user.id}}" />
  <table>
    {{#each criteria}}
      {{> criterion}}
    {{/each}}
  </table>
  <div style="margin-top: 20px">Comments:</div>

  <h3>Comments</h3>
  <textarea id="comment" class="text" name="comment" cols="40" rows="5">{{comment.text}}</textarea>
  <div>
    <button id="vote" class="btn-primary">Vote</button>
  </div>
</form>
<div id="voting-results">
</div>
{{/unless}}

{{#contentFor "pageScripts"}}
$('#vote').on('click', function(ev) {
  ev.preventDefault();
  var id = $('input[name="submission_id"]').val();
  $('#voting-widgets').hide();
  $('#voting-results').html('Voting in progress. Please, wait...');
  $.ajax({
    url: '/admin/submissions/' + id + '/vote',
    method: 'post',
    data: $('#voting-widgets').serialize()
  }).done(function(result) {
    console.log('status', result);
    $('#voting-results').html('Voting done. Your score: ' + result.score);
  }).fail(function(err) {
    alert(err);
  });
});
{{/contentFor}}
